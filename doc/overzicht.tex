\chapter{Overzicht project}
Het project kan worden opgedeeld in 2 grote delen: een backend die instaat voor het beheer van alle data in het spel, en een heleboel modules die zich op deze backend enten en de data manipuleren.

\section{Backend}
De backend is het enige deel van dit project dat in rechtstreeks contact staat met de database. Het bepaalt wie welke informatie kan opvragen aan de hand van een uitgebreid authorisatiemechanisme, en laat toe om op een gebruiksvriendelijke manier informatie op te vragen en te manipuleren.
Om de overhead door deze backend zo licht mogelijk te houden, werd er gekozen voor een zo licht mogelijk protocol: XML-RPC. Dit laat toe om een grote verscheidenheid aan modules te laten communiceren met de backend: van een volwaardige ASP.NET-website, over een scrapermodule in Perl, tot een eenvoudige applet in Java ME: het protocol is in staat om aan de behoeften van elke module te voldoen.
\subsection{Filtering}
Om elke client toe te laten om gerichte aanvragen te maken, was er nood aan een manier waarop specifieke objecten opgevraagd konden worden. Daarom werd ervoor gekozen om een eigen filtermechanisme te schrijven.

\section{Website}
Op het website-gedeelte van dit project kunnen spelers deelnemen aan het StockPlay-spel. Hier kunnen ze de effecten die in dit spel zitten bekijken, orders aanmaken en hun portefolio beheren.
\subsection{Dynamische grafieken}
Uit de beurskoersen van het verleden kan veel informatie gepuurd worden, daarom is een goeie tool om de historische beurskoersen te kunnen analyseren geen overbodige luxe. Er werd voor gekozen om zelf een Javascript-library te ontwikkelen om de grafieken weer te geven. Deze javascript-library communiceert via JSON met de ASP.NET-website om de nodige data op te halen.

\section{Administratie desktopclient}
Er werd bij dit project voor gekozen om de component met Java Swing in te vullen als administratieclient voor het project. Bij dit administratieprogramma krijgt een beheerder een overzicht over de status van de verschillende componenten. De beheerder kan ook de aanwezige effecten en gebruikers opvragen, en deze desgewenst aanmaken, wijzigen of verwijderen.

\section{Beurskoersen-scraper}
Het is evident dat een beursspel zonder live beurskoersen niet veel voorstelt.. De scraper is in dit project dan ook een van de meest vitale delen: de scraper haalt live koersinformatie van alle effecten uit het spel uit de AJAX-feed van de krant "De Tijd", en voegt deze continue toe aan het spel. De scraper is zodanig opgezet dat ze volledig modulair werkt, en extra bronnen kan aanspreken om bijkomende beursinformatie op te halen (bijvoorbeeld een tweede feed).
\subsection{Historische beurskoersen-scraper}
Er was ook nood aan meer extensieve informatie voor elk effect. Bijvoorbeeld om onze AI-speler goeie inschattingen te kunnen laten maken, alsook om voldoende informatie te kunnen tonen aan onze spelers in de grafieken, was er nood aan historische beurskoersen. Daarom werd ook een scraper gemaakt die op de website van Euronext de historische data ophaalde.

\section{AI-speler}
Om ook in de beginfase de eerste spelers van genoeg concurrentie te voorzien, werd er ook een AI-speler ontwikkeld. Deze AI-speler gebruikt een genetisch algoritme om zijn orders te bepalen. Door te vari\"eren in de aangeboden parameters aan elke AI-instantie kunnen gemakkelijk verschillende AI-spelers worden aangemaakt. Dit laat toe om op een eenvoudige wijze het spel te voorzien van genoeg spelers om het ook voor de eerste menselijke spelers direct interessant te maken, en te houden natuurlijk!

\section{Mobiele spelclient}
Om aan te tonen dat onze keuze voor het XML-RPC protocol ons veel mogelijkheden bood, werd er ook een client ontwikkeld in de vorm van een Java ME-applicatie. Java ME bevat slechts zeer rudimentaire functionaliteit, maar toch was ook daarvoor een XML-RPC-client beschikbaar.
Met deze client kan een speler zijn portfolio en zijn huidige orders opvragen. De client staat ook enkele rudimentaire bewerkingen toe zoals het cancellen van een nog niet uitgevoerd order, alsook het aanmaken van een nieuw order.

\section{Transactiemanager}
Spelers kunnen op de website orders aanmaken om een effect te kopen/verkopen, en dit wanneer het aan bepaalde voorwaarden voldoet (zie hoofdstuk \ref{chap:geavanceerde_orders}). De uitvoering van een order is echter een aparte taak: in het echte leven wordt een order doorgestuurd naar de beurs, en pas als alle voorwaarden voor de order voldaan zijn. Dit betekent dus dat aan alle technische voorwaarden is voldaan, en dat er een tegenpartij is die het effect wil kopen of verkopen tegen de aangegeven prijs.

In onze applicatie gebeurt het verwerken van de orders en het omzetten naar transacties door een extra module die deze taak van de beurs simuleert: de transactiemanager. Deze module zal 1 keer per minuut alle actieve orders overlopen, en degene waar alle voorwaarden van voldaan zijn worden omgezet in transacties.

\section{Puntenmanager}
Deze applicatie zal op gezette tijden (dit door middel van een cronjob) alle spelers in het spel evalueren en op basis van hun prestaties over een bepaalde periode (dag, week, maand, ...) punten toekennen. Met deze punten is het mogelijk om een klassement op te stellen van de spelers in het spel. Zo kan elke speler in het spel, van beginner tot de meest gevorderde speler, zich telkens bepaalde doelen stellen (bijvoorbeeld: eerste in het weekklassement worden), en blijft het spel voor iedereen een haalbare kaart.


\chapter{Ontwikkelingsevolutie}


\section{Taakverdeling}
De grote omvang van het project zorgde ervoor dat al snel iedereen zich begon toe te leggen op bepaalde domeinen van het project, en dit met uitzondering van n onderdeel: de grote gemene deler van het project, de backend.

\begin{itemize}
	\item \textbf{Tim Besard: }
	\begin{itemize}
		\item Implementatie van XML-RPC-backend
		\item Live beurskoersen-scraper
		\item Historische beurskoersenscraper
		\item AI-spelers
	\end{itemize}
	
	\item \textbf{Dieter Deforce: } 
		\begin{itemize}
			\item Toevoegen functionaliteit in de backend
			\item ADO.NET-interface met de backend\footnote{Het gebruik van ADO.NET was een vereiste van het project, en moest worden gedemonstreerd. De ADO.NET-interface werd na de demo uit het project gehaald}
			\item De XML-RPC.NET-client die instaat voor de communicatie met de backend voor applicaties op het .NET-platform
			\item De ASP.NET-website
			\item De puntenmanager, die spelers op gezette tijden evalueert en punten toekent
		\end {itemize}
		
	\item \textbf{Laurens Van Acker: }
	 \begin{itemize}
	 	\item Toevoegen functionaliteit in de backend
	  \item Javascript-library ontwikkelen om dynamische grafieken weer te geven
	  \item Grafisch ontwerp website
	 	\item Transactiemanager: uitbouw structuur, verwerking van de geavanceerde orders.
	 	\item Filtering: toevoegen van extra functionaliteit
	 \end{itemize}
	 
	 \item \textbf{Thijs Walcarius: }
	 \begin{itemize}
	 	\item Ontwerp Data Access Objects voor communicatie tussen backend en database
	 	\item Instellen van Oracle-database, ontwerp triggers
	 	\item Java Administratieclient
	 	\item Java ME mobiele client
	 	\item Rudimentaire versie transactiemanager
	 \end{itemize}
\end{itemize}


\section{Planning}

Door de strikte timing van het project met zijn verschillende iteraties kon er niet gewacht worden op een volledig functionele backend om vanaf te starten.. De ontwikkeling verliep vooral rond de verschillende iteraties.

\subsection{Alfa-iteratie}
Voor elk groot onderdeel van het project moest er iets gedemonstreerd kunnen worden. We waren dus verplicht om zeer snel te bepalen op welke fundatielaag we gingen werken, om zo voor elk onderdeel één stuk rudimentair te kunnen uitwerken.

\subsubsection{Backend}
Er werd gezocht naar een propere manier om de backend op te bouwen: hoe wordt de database best benaderd? Wat is een goeie structuur voor de backend zelf? Hoe bouwen we de XML-RPC-berichten op?
Uiteindelijk werd het deel van de backend dat zich bezig houdt met het opvragen, aanmaken en wijzigen van effecten gekozen als pilootproject.
\paragraph{Filtering}
Om clients de mogelijkheid te bieden om op een eenvoudige manier objecten te selecteren werd een eigen filter geschreven.
\paragraph{Data Access Objects}
Omdat de voorstelling van data in de backend nogal verschilt van de voorstelling in de database, werd er gezocht naar een systeem dat de omzetting zo pijnloos mogelijk maakte.. Omdat dit een probleem is waarmee bijna elk softwarepakket dat gebruik maakt van een database wordt geconfronteerd, bestaan hier ook design patterns voor: er werd gekozen om het 'Data Access Object'-pattern te implementeren.

\subsubsection{Website}
Ontwikkeling van een ADO.NET-interface met de backend. Eerste rudimentaire functionaliteit inbouwen voor het ophalen en weergeven van effecten. Ook werd er gezocht naar manieren om de gegenereerde HTML-code vanuit ASP.NET wat op te schonen zodat er vlotter gebruik kon worden gemaakt van CSS-stylesheets.
\paragraph{Dynamische grafieken}
Er werd gezocht naar een goeie manier om de historische koersinformatie grafisch weer te geven. Daarom werden verschillende javascript grafieklibraries met elkaar vergeleken en uitgetest.

\subsubsection{Administratie desktopclient}
Voor de Java Swing-applicatie werd er gezocht naar een manier om een mooi en functioneel programma te maken. Er werd eerst voor geopteerd om zelf een verticale menubalk te maken vergelijkbaar met de menubalk uit MS Office Outlook 2003, maar we liepen al snel tegen beperkingen van Java in verband met precieze timing. Uiteindelijk werd er geopteerd om de SwingX-library te gebruiken.
Bij deze iteratie was de basisfunctionaliteit om de effecten op te halen aanwezig. Hiervoor werd ook het XML-RPC-client-gedeelte geschreven die zich met het beheer van effecten bezig houdt.

\subsubsection{Beurskoersen-scraper}
Verschillende bronnen van koersinformatie werden gezocht, en er gebeurde een eerste implementatie om de AJAX-feed van Tijd.be te verwerken.

\subsubsection{Mobiele spelclient}
Er werd uitgezocht of er goeie XML-RPC-clients beschikbaar waren. Ook werd de functionaliteit van het Java ME-platform onderzocht, en de mogelijkheden van Rapid Application Development-tools onderzocht (in casu: de Netbeans IDE hiervoor)


\subsection{Beta-iteratie}
Bij deze iteratie werd er vooral gefocust om zoveel mogelijk functionaliteiten in te bouwen. De bedoeling was om tegen de beta-iteratie een spel te kunnen aanbieden waarbij de speler beschikte over alle basisfunctionaliteiten: beheer van zijn portfolio, aanmaken van orders, bekijken van aandelen, etc.
Om tegemoet te komen aan de vraag om een algoritmisch aspect in te bouwen, werd er ook voor geopteerd om een AI-speler te ontwikkelen.

\subsubsection{Backend}
Het volledige protocol werd geimplementeerd in de backend. Ook gebeurden er aanpassingen aan het protocol om het aantal requests van de clientmodules te beperken, en zo een vlottere gebruikerservaring te kunnen aanbieden.

\subsubsection{Website}
De website werd verder uitgewerkt: gebruikersregistratie, beheer van portfolio, aanmaken van orders.
\paragraph{Dynamische grafieken}

\subsubsection{Administratie desktopclient}
De clientlibrary werd volledig afgewerkt, zodat ze bijna alle functionaliteiten uit de backend bevatte.
Vervolgens werd er gewerkt aan het bewerken van de opgehaalde effecten, alsook werd er begonnen aan het gebruikersbeheer. Omdat de benodigde functionaliteit tussen het effectenbeheer en het gebruikersbeheer danig verschilde, werd er voor geopteerd om geen generiek CRUD-design te gebruiken, maar aparte implementaties te voorzien.

\subsubsection{Beurskoersen-scraper}
De scraper werd verder afgewerkt, en kan nu ook zelfstandig de nodige effecten en beurzen aanmaken.
\paragraph{Historische beurskoersen-scraper}
Er werd ook een historische beurskoersen-scraper gemaakt die alle historische koersen vanaf Euronext ophaalt (1 koers per dag)

\subsubsection{AI-speler}
Vooreerst werd er gezocht naar wat de beste manier is om generische algoritmen toe te passen op beurskoersen. Daarvoor werd er beroep gedaan op vakliteratuur die daarover beschikbaar was. Vervolgens werd er ge\"experimenteerd met verschillende programmeertalen om uit te zoeken wat het snelst resultaat zou opleveren. Uiteindelijk werd er gekozen voor Perl omdat deze programmeertaal op eenvoudige wijze toelaat om complexe gegevensstructuren te verwerken met een goede performantie.

\subsubsection{Mobiele spelclient}
Omdat er op andere gebieden te veel werk was, werd er besloten om de mobiele client niet op te nemen in de beta-iteratie

\subsubsection{Transactiemanager}
De transactiemanager was lange tijd uit het oog verloren. Omdat het echter toch een essentieel element is om het volledige spel te simuleren, werd uiteindelijk last-minute een prototype gemaakt. Op een uur of drie kon een volledig functionele transactiemanager worden gemaakt voor de eenvoudige types orders (immediate order, en orders met een enkelvoudige limiet)


\subsection{Release}

\subsubsection{Backend}
De backend reageerde vaak niet snel genoeg op aanvragen, bij nader onderzoek bleek er een serieuze bottle-neck aanwezig te zijn bij de connectie tussen de database en de backend. Oracle stuurde vaak aan zijn bovenlimiet qua snelheid informatie door, waardoor kostbare seconden verloren gingen. Er werd daarom voor gekozen om een cachingmechanisme in te bouwen. Dit werd echter niet van de grond af gedaan, maar er werd gebruik gemaakt van een reeds publiek beschikbare library 'cache4j'.
Ook werd er een beveiligingsmechanisme ingebouwd, zodat afhankelijk van de aangemelde gebruiker maar een beperkte subset van de backend-API aanspreekbaar werd.

\subsubsection{Website}
De nog ontbrekende stukken werden toegevoegd: de ranking, [VUL AAN]. Ook werd er functionaliteit toegevoegd om complexe orders in te voeren.
\paragraph{Dynamische grafieken}
Er werd de mogelijkheid toegevoegd om een tweede effect op de grafiek toe te voegen, zodat effecten gemakkelijker met elkaar kunnen worden vergeleken. 

\subsubsection{Administratie desktopclient}
De mogelijkheid om met een elektronische identiteitskaart in te loggen werd toegevoegd. Omdat er te weinig tijd restte om uit te zoeken hoe vervolgens op een met certificaten beveiligde manier een beveiligde sessie op de backend kon worden aangevraagd, is het nodig dat lokaal de logingegevens van een administrator-account worden opgeslagen om een nieuw sessie-id te kunnen aanmaken.

\subsubsection{Beurskoersen-scraper}
\paragraph{Historische beurskoersen-scraper}
\todo TIM
\subsubsection{AI-speler}
\todo TIM

\subsubsection{Mobiele spelclient}
De mobiele spelclient werd weer terug opgenomen. De client-library die beschikbaar was in Java werd geport naar Java ME. Aanvankelijk ging dat gepaard met de ene teleurstelling na de andere door het gebrek aan functionaliteit (geen enums, geen generics, etc), maar daar werd al snel een mouw aan gepast.. Om tijd  te sparen werd er wel besloten om wat extra functionaliteit uit de mobiele client te schrappen. Het is immers een nogal log systeem om te debuggen, en deze module is eerder bedoeld als een proof-of-concept dan als een essentieel onderdeel uit ons project.

\subsubsection{Transactiemanager}
De transactiemanager werd uitgebreid met geavanceerde orders.
\todo LAURENS

\subsubsection{Puntenmanager}
De puntenmanager was het laatste grote ontbrekende deel aan het project. Deze werd dan ook snel in deze iteratie onder handen genomen.
\todo DIETER

\chapter{Projectevaluatie}


\section{SWOT-analyse}

\subsection{Strenghts}

De grootste sterkte van dit project is onze backend. In dit deel van het project werd het meeste tijd gestopt, en het resultaat is een elegant, flexibel en coherent geheel. 
Zo is de datalaag van onze backend erop voorzien dat er gemakkelijk van onderliggende database kan worden gewisseld, en zijn er ook faciliteiten ingebouwd om een vlotte conversie van de interne objecten naar de gebruikte gegevensstructuren in het XML-RPC-protocol.


\subsection{Weaknesses}

\paragraph{Mobiele client} De mobiele client werd niet opgebouwd op een erg robuuste manier. Zou deze verder ontwikkeld worden, dan zou er al snel nood zijn aan een grote herorganisatie van de code om ze flexibeler te maken.

\todo Known issues / bugs

\subsection{Opportunities}

\paragraph{Algemeen} Het doel van het spel is om zoveel mogelijk de beurs in het echte leven de simuleren. Dit is echter zo'n danig complex gegeven dat we nog lang niet een levensecht spel hebben gecre\"erd. Elementen die nog in het spel ontbreken zijn bijvoorbeeld het aanrekenen van transactiekosten en bewaargelden. 
Momenteel is er ook maar een beperkt aantal beurzen aanwezig in het spel. We werden hiertoe gedwongen omdat de gescrapete data van andere beurzen vaak niet granulair genoeg was. Zou er echter beschikking zijn over betere datafeeds, dan kan het spel op dit vlak snel uitbreiden. Indien er ook beurzen zouden bijkomen die met andere munteenheden werken, zou ook dit een extra dimensie aan het spel kunnen toevoegen, het werken met vreemde munten kan gelukkig snel worden ingebouwd in de bestaande voorzieningen.

\paragraph{Puntenmanager} De puntenmanager voorziet in alle faciliteiten om gebruikers op verschillende vlakken te quoteren. Om het spel intersanter en aantrekkelijker te maken is het een goed idee om nog verder te zoeken naar domeinen waar een speler op kan worden gequoteerd. Het is misschien ook een goed idee om aparte klassementen te voorzien voor bepaalde criteria (bijvoorbeeld: met zo weinig mogelijk transacties toch zo goed mogelijk scoren)

\todo Uitbreidingsmogelijkheden

\subsection{Threats}

\todo zwakheden in ons model (probeer hier creatief te zijn en zwakheden te zetten die eigenlijk positief zijn (vb. als je later op een sollicitatiegesprek zo'n analyse van jezelf moet maken is een goeie ``door mijn oog voor detail durf ik wel eens te lang doorgaan op een deelprobleem'')

\paragraph{Algemeen} Het door ons gekozen onderwerp was zodanig breed en complex, dat er al snel de verleiding kwam om teveel elementen vanuit de echte wereld van de financi\"ele markten in ons spel te verwerken. Dit heeft ertoe geleid dat we ons project soms iets te breed hebben gezien, waardoor de workload onaangenaam hoog is komen te liggen.. Het was misschien beter geweest om een iets nauwere scope te nemen, zodat we ons ook wat meer op de afwerking van onze code konden richten.

\paragraph{Backend}
Het cachingmodel dat werd ingebouwd in de backend kan nog verder worden verfijnd. Momenteel wordt er nog te weinig rekening gehouden met mogelijke veranderingen van de achterliggende data. Er wordt best gezocht naar een meer geavanceerd model, of een eigen cachingmechanisme. Het filtersysteem dat werd ingebouwd in de backend is flexibel gemaakt, en er dus ook op voorzien om ook opzoekingen in andere gegevensstructeren mogelijk te maken, wat natuurlijk goede perspectieven biedt..

